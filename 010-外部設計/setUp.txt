drop table if exists carts;
drop table if exists order_details;
drop table if exists orders;
drop table if exists users ;
drop table if exists items;
drop table if exists colors;
drop table if exists categories;
drop sequence items_item_id_seq;
drop sequence orders_order_id_seq;

-- ユーザー
CREATE TABLE users(
 email VARCHAR(255) NOT NULL,
 password VARCHAR(255) NOT NULL,
 user_name VARCHAR(255) NOT NULL,
 address VARCHAR(255)NOT NULL,
 withdraw_flag BOOLEAN NOT NULL DEFAULT FALSE,
 withdraw_day DATE,
 PRIMARY KEY(email)
);

-- カテゴリー
CREATE TABLE categories(
 category_id INTEGER NOT NULL,
 category_name VARCHAR(255) NOT NULL,
 PRIMARY KEY(category_id)
);

-- 商品の色
CREATE TABLE colors(
 color_id INTEGER NOT NULL,
 color_name VARCHAR(255) NOT NULL,
 PRIMARY KEY(color_id)
);


--　商品
CREATE TABLE items(
 item_id INTEGER NOT NULL,
 category_id INTEGER NOT NULL,
 item_name VARCHAR(255) NOT NULL,
 color_id INTEGER NOT NULL,
 manufacturer_name VARCHAR(255) NOT NULL,
 price NUMERIC(10) NOT NULL,
 stock NUMERIC(5) NOT NULL,
 recommend BOOLEAN NOT NULL DEFAULT FALSE,
 PRIMARY KEY(item_id),
 FOREIGN KEY(category_id) references categories(category_id),
 FOREIGN KEY(color_id) references colors(color_id)
);

-- カート
CREATE TABLE carts(
 email VARCHAR(255) NOT NULL,
 item_id INTEGER NOT NULL,
 amount NUMERIC(5) NOT NULL,
 PRIMARY KEY(email,item_id),
 FOREIGN KEY(email) references users(email),
 FOREIGN KEY(item_id) references items(item_id)
);


-- 購入履歴ヘッダ 支払方法追加
CREATE TABLE orders(
 order_id INTEGER NOT NULL,
 email VARCHAR(255) NOT NULL,
 delivery_address VARCHAR(255) NOT NULL,
 order_date DATE NOT NULL,
 payment VARCHAR(255) NOT NULL,
 cancel_flag BOOLEAN NOT NULL DEFAULT FALSE,
 cancel_date DATE,
 PRIMARY KEY(order_id),
 FOREIGN KEY(email) references users(email)
);

-- 購入履歴詳細
CREATE TABLE order_details(
 order_id INTEGER NOT NULL,
 item_id INTEGER NOT NULL,
 quantity numeric(5),
 PRIMARY KEY (order_id,item_id),
 FOREIGN KEY (order_id) references orders(order_id),
 FOREIGN KEY (item_id) references items(item_id)
);


CREATE SEQUENCE items_item_id_seq
 INCREMENT BY 1
 MINVALUE 1
 MAXVALUE 99999
 START WITH 1
 NO CYCLE;

CREATE SEQUENCE orders_order_id_seq
 INCREMENT BY 1
 MINVALUE 1
 MAXVALUE 99999
 START WITH 1
 NO CYCLE;

-- users
INSERT INTO users (email, password, user_name, address, withdraw_flag, withdraw_day)
 VALUES 
('a@icloud.com', '@Test0000', 'テスト太郎', '東京都千代田区千代田1-1', FALSE, NULL),
('b@icloud.com', '@Test0001', 'テスト太郎1', '東京都千代田区千代田1-1', FALSE, NULL),
('c@icloud.com', '@Test0002', 'テスト太郎2', '東京都千代田区千代田1-1', TRUE, '2025-09-05');

-- categories
INSERT INTO categories (category_id, category_name)
 VALUES 
(1, '帽子'),
(2, '鞄');

-- colors
INSERT INTO colors (color_id, color_name)
 VALUES
(1, '黒'),
(2, '白'),
(3, '茶');


-- items
INSERT INTO items (item_id, category_id, item_name, color_id, manufacturer_name, price, stock, recommend)
 VALUES 
(nextval('items_item_id_seq'), 1,'大人用', 1 , '帽子専門店', 1000, 10000, TRUE),
(nextval('items_item_id_seq'), 1,'麦わら', 3 , '帽子専門店', 800, 1000, FALSE),
(nextval('items_item_id_seq'), 1,'子供用', 2 , '帽子専門店', 600, 100, FALSE),
(nextval('items_item_id_seq'), 2,'普段用', 1 , '鞄専門店', 3000, 10, FALSE),
(nextval('items_item_id_seq'), 2,'登山用', 3 , '鞄専門店', 2000, 10, FALSE),
(nextval('items_item_id_seq'), 2,'仕事用', 1 , '鞄専門店', 5000, 10, FALSE);

-- carts
INSERT INTO carts (email, item_id, amount)
 VALUES 
('a@icloud.com', 1, 10),
('a@icloud.com', 2, 10);

-- orders
INSERT INTO orders (order_id, email, delivery_address, order_date, payment)
 VALUES 
(nextval('orders_order_id_seq'), 'a@icloud.com', '東京都千代田区千代田1-1', '2025-09-05', '代金引換'),
(nextval('orders_order_id_seq'), 'b@icloud.com', '東京都千代田区千代田1-1', '2025-09-06', '代金引換');

-- order_details
INSERT INTO order_details (order_id, item_id, quantity)
 VALUES 
(1, 1, 10),
(1, 2, 10),
(2, 1, 10);









